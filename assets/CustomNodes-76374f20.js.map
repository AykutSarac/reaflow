{"version":3,"file":"CustomNodes-76374f20.js","sources":["../../docs/Advanced/CustomNodes.mdx"],"sourcesContent":["import { Meta } from '@storybook/addon-docs/blocks';\n\n<Meta title=\"Docs/Advanced/Custom nodes\" />\n\n# Custom nodes\n\nUsing HTML within a `Node` component relies on the SVG [`foreignObject`](https://developer.mozilla.org/en-US/docs/Web/SVG/Element/foreignObject).\n\n> You do not need to use `xmlns` (XML NameSpace) in the first `div` within `foreignObject`, it's only required when the SVG is a whole document.\n\n## Rendering different kinds/types of nodes\n\nMost apps will need to render different kinds of nodes. The way to go is to use a Node \"[Router](https://github.com/Vadorequest/poc-nextjs-reaflow/blob/734018e8135523fccc2c01077294bca0a32ddfbe/src/components/nodes/NodeRouter.tsx#L43)\" component, which checks what the node's type is, and renders the related React component.\n\n## How does `foreignObject` render in HTML?\n\nWhile using `foreignObject` allows building components using usual HTML/CSS, there are a few quirks to consider.\n\n```html\n<!-- \"g\" is a graph representing a Node \"container\" -->\n<g cursor='initial' opacity='1' style='transform: translateX(1702px) translateY(495.333px) translateZ(0px); transform-origin: 100px 50px;'>\n  <!-- \"rect\" is a rectangle representing the reaflow \"Node\" component, it's what events are bound to -->\n  <rect tabindex='-1' class='Node-module_rect__1Eal3 node-svg-rect node-information-svg-rect' height='100' width='200' rx='2' ry='2' opacity='1' style='stroke-width: 0; fill: white; color: black; cursor: auto;'></rect>\n\n  <!-- \"foreignObject\" is the root containing your custom HTML for the node -->\n  <foreignObject id='node-foreignObject-2ca8efe0-75ed-11eb-8896-7bd259f8797e' class='information-node-container node-container css-1ncbppe-BaseNode' width='200' height='100'>\n    <!-- The first div, should use \"position: fixed\" for children to display properly -->\n    <div class='node'>\n      Node content\n    </div>\n  </foreignObject>\n\n  <!-- Ports -->\n  <g>\n    <rect height='29' width='29' x='-14.5' y='35.5' class='Port-module_clicker__ZivO1'></rect>\n    <rect class='Port-module_port__30o1q 2ca8a1c0-75ed-11eb-8896-7bd259f8797e port' height='15' width='15' rx='15' ry='15' opacity='1' style='fill: white; stroke: white; transform: translateX(-7.5px) translateY(42.5px) scale(1) translateZ(0px); transform-origin: 7.5px 7.5px;'></rect>\n  </g>\n  <g>\n    <rect height='29' width='29' x='185.5' y='35.5' class='Port-module_clicker__ZivO1'></rect>\n    <rect class='Port-module_port__30o1q 2ca8c8d0-75ed-11eb-8896-7bd259f8797e port' height='15' width='15' rx='15' ry='15' opacity='1' style='fill: white; stroke: white; transform: translateX(192.5px) translateY(42.5px) scale(1) translateZ(0px); transform-origin: 7.5px 7.5px;'></rect>\n  </g>\n  <g></g>\n</g>\n```\n\n## Known issues and workarounds\n\n### Use `position: fixed` in the first div\n\nYou must apply `position: fixed` to the first `div` element contained by the `foreignObject`, otherwise any child element using `position` [will not be displayed](https://github.com/reaviz/reaflow/issues/44#issuecomment-776883460).\n  - This issue was the reason why `react-select` and `ChakraUI Select` components wouldn't display properly.\n\n### Z-index doesn't have any effect on SVG elements\n\nThe `foreignObject` is still a SVG element, and it is displayed on top of the `rect` (which represents the Node component created by reaflow).\n\nIt is not possible to re-order SVG elements using `z-index`.\nThe rule of display on the Z index being \"the last element is displayed on top of the other element\".\n\n### The `foreignObject` will steal events (onClick, onEnter, onLeave, etc.) that are bound to the `rect` (Node)\n\nBecause the `foreignObject` displays on top of the `rect` element, it will \"steal\" events such as onClick, onEnter/onLeave (mouse).\n\nThose events are provided by default by Reaflow `Canvas` to its `Node` components.\nThus, by using `foreignObject`, **none of the built-in Node events will work anymore**, [unless you set `pointer-events: none` to the `foreignObject` element](https://github.com/reaviz/reaflow/discussions/34).\n\nAlthough, even if you disable `pointer-events`, depending on your Node component UI, it might only work for part of the component.\n\nMany built-in behaviors will be affected because of this, such as:\n- Dragging an edge from a node\n  - Dragging won't work if the click doesn't happen on the `rect`\n- Selecting nodes\n  - The click won't work it doesn't happen on the `rect`\n  - Using shortcuts for multiple selection [won't work because keyboard events won't be captured](https://github.com/reaviz/reaflow/issues/50)\n\nThat's why, in addition to disabling `pointer-events`, **you might also want [to forward the native events](https://github.com/Vadorequest/poc-nextjs-reaflow/blob/272a23604e0a11ef0726e19091be58ffd5861d62/src/components/nodes/BaseNode.tsx#L357-L360)** (onClick, onEnter, onLeave, onKeyPress, etc.) to the main div (`.node` above).\n\nBy forwarding those events to the first `div`, you'll work around most of the above-mentioned issues.\n\n### Entering/leaving a node\n\nDepending on how complicated your HTML is within the nodes themselves, it might be tough to detect whether you're in a node or not.\n\nWhen not using `foreignObject`, it is really straightforward, but when the `foreignObject` contains complex HTML structure, the `onEnter/onLeave` events applied to main `div` will trigger when hovering other elements within that node, leading to a tons of false-positive events.\n\nAt this time, there was no viable solution being reported to work around this issue.\n\n## Community examples\n\n- [Vadorequest/poc-nextjs-reaflow](https://github.com/Vadorequest/poc-nextjs-reaflow) uses custom nodes UI, and [all nodes relies on `foreignObject`](https://github.com/Vadorequest/poc-nextjs-reaflow/blob/287141b94145eec18fb02aab8f00676ae92f1310/src/components/nodes/BaseNode.tsx#L279-L418)\n"],"names":["_createMdxContent","props","_components","_provideComponents","_jsxs","_Fragment","_jsx","Meta","MDXContent","MDXLayout"],"mappings":"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"}